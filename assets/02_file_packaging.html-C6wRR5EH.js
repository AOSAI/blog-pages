import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,o as e,e as i}from"./app-C6YC_Rpq.js";const s={},l=i(`<h2 id="为什么要打包" tabindex="-1"><a class="header-anchor" href="#为什么要打包"><span>为什么要打包</span></a></h2><p>众所周知，Python 文件不能在没有安装 Python 环境的机器上运行，所以需要通过打包这样的方式，让其可以在任何电脑上直接使用。打包方式应该会很多，但我目前查到的，有两种用的较多的打包方式，Nuitka 和 Pyinstaller。</p><h2 id="pyinstaller-打包" tabindex="-1"><a class="header-anchor" href="#pyinstaller-打包"><span>Pyinstaller 打包</span></a></h2><h3 id="打包单个文件" tabindex="-1"><a class="header-anchor" href="#打包单个文件"><span>打包单个文件</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>pip install pyinstaller     # 下载安装命令</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 打包命令的常用基础操作</span></span>
<span class="line"><span>Pyinstaller -F xxx.py   # 打包exe</span></span>
<span class="line"><span>Pyinstaller -F -w xxx.py    # 不带控制台打包</span></span>
<span class="line"><span>Pyinstaller -F -w -i xxx.ico xxx.py    # 指定exe图标打包</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置虚拟环境" tabindex="-1"><a class="header-anchor" href="#设置虚拟环境"><span>设置虚拟环境</span></a></h3><p>这样打包简单是简单了，但是打包过程极慢，而且 exe 文件的体积也是巨大。有知乎大佬说，是因为 Anaconda 内置了很多库，打包的时候打包了很多不必要的模块进去，所以需要纯净的 Python 来打包。</p><p>我们可以模拟一个新的环境，其中只安装本次打包所需要的模块即可。Anaconda 本身就可以做到，conda 安装的虚拟环境，会将目录生成在 anaconda 安装目录的 env 目录下。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>conda create -n folder_name python==x.x     # 创建虚拟环境</span></span>
<span class="line"><span>conda activate folder_name      # 激活虚拟环境</span></span>
<span class="line"><span>conda deactivate        # 退出虚拟环境</span></span>
<span class="line"><span></span></span>
<span class="line"><span>conda info --envs       # 查看conda环境下的所有虚拟环境</span></span>
<span class="line"><span>conda list          # 在激活虚拟环境后，此命令可以查看已经安装的库</span></span>
<span class="line"><span>conda remove -n folder_name/all     # 删除指定/全部虚拟环境</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="打包多个文件" tabindex="-1"><a class="header-anchor" href="#打包多个文件"><span>打包多个文件</span></a></h3><p>我们通过修改 .spec 文件实现多个文件、资源打包。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>pyi-makespec -w main.py   # 生成 main.spec文件</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>打开 .spec 文件，将其余的 py 文件按相同格式添加到 main.py 后面，把文件夹类的添加到 binaries 中，spec 中还有很多参数，具体请查阅相关资料。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>pyinstaller main.spec  # 打包操作</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="nuitka-打包指南-windows" tabindex="-1"><a class="header-anchor" href="#nuitka-打包指南-windows"><span>Nuitka 打包指南（windows）</span></a></h2><h3 id="安装-c-编译器" tabindex="-1"><a class="header-anchor" href="#安装-c-编译器"><span>安装 C 编译器</span></a></h3><p>首先要安装 C 语言/C++的编译器，<a href="https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/" target="_blank" rel="noopener noreferrer">Mingw64 下载网址</a>，这里我也踩了个坑，我下的 8.x 的版本，但是打包的时候用了 --mingw64，告诉我要 11 版本的，最后查阅文档才发现 win 系统要求必须基于 gcc11.2 或者更高，macOS 需要用 clang 编译器。报错给我的新的文件下载路径是<a href="https://github.com/brechtsanders/winlibs_mingw/releases/download/11.3.0-14.0.3-10.0.0-msvcrt-r3/winlibs-x86_64-posix-seh-gcc-11.3.0-llvm-14.0.3-mingw-w64msvcrt-10.0.0-r3.zip" target="_blank" rel="noopener noreferrer">Mingw64_11</a></p><p>下载完解压之后不要忘记配置环境变量（windows11）： 系统 -&gt; 系统信息 -&gt; 高级系统设置 -&gt; 环境变量 -&gt; 系统变量 -&gt; Path -&gt; 新建路径为 Mingw64 的 bin 目录文件路径。例如我的：D:\\Mingw64\\mingw64\\bin</p><p>命令行界面中通过 gcc -v，测试环境配置是否成功。</p><h3 id="nuitka-基本操作" tabindex="-1"><a class="header-anchor" href="#nuitka-基本操作"><span>Nuitka 基本操作</span></a></h3><p>网上现有的教程，都还停留在 0.6 版本、1.0 版本，很多的方法在迭代的过程中已经被更替了，这就导致我花费了很长的时间，去查阅相关文档。这个官方文档找它也是费了我一番功夫，在我之前的经验里，搜索引擎直接搜索，是会有合适的正确的文档在内的，但是这个它只有最老版本的中文文档显示，所以我找到了 Github 里去，终于找到了最新的。</p><p>同时这里贴两篇知乎大佬的博文，以及附上官方的文档。虽然知乎大佬写的文章，有些关于--plugin-enable 的内容已经不适用了，但是如果按照它的版本去做，也还是能行的。官方的文档里有每次升级，做的整改的记录，有利于我们对比学习。</p><p><a href="https://zhuanlan.zhihu.com/p/133303836" target="_blank" rel="noopener noreferrer">知乎：Python 打包 exe 的王炸-Nuitka</a><a href="https://zhuanlan.zhihu.com/p/137785388" target="_blank" rel="noopener noreferrer">知乎：Nuitka 之让天下的 Python 都可以打包</a><a href="https://nuitka.net/index.html" target="_blank" rel="noopener noreferrer">Nuitka 官方文档</a></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 下载Nuitka模块，目前下载的稳定版本是1.8</span></span>
<span class="line"><span>pip install Nuitka</span></span>
<span class="line"><span># 如果要下载指定版本，用 =x.x.x 连接</span></span>
<span class="line"><span>pip install Nuitka=x.x.x</span></span>
<span class="line"><span># 查看Nuitka的版本等信息</span></span>
<span class="line"><span>pip show Nuitka</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 简单打包单个文件</span></span>
<span class="line"><span>python -m nuitka --follow-imports main.py</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上就是基本的操作，大体框架是没有变动的，变动的是类似 --plugin-enable=numpy 这样的参数。 使用 nuitka --help 命令可以查看所有参数。本次我用到的命令有这些：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>python -m nuitka --mingw64 --windows-disable-console --nofollow-imports --standalone --plugin-enable=no-qt CompressPhotos.py</span></span>
<span class="line"><span></span></span>
<span class="line"><span>python -m nuitka --mingw64 --windows-disable-console --nofollow-imports --standalone --plugin-enable=no-qt Main.py</span></span>
<span class="line"><span></span></span>
<span class="line"><span># --output-dir：设置输出的目标文件夹</span></span>
<span class="line"><span># --follow-imports：将 mian.py 中 import 的所有文件或模块一同打包</span></span>
<span class="line"><span># --standalone：让生成的 exe 文件脱离 python 环境</span></span>
<span class="line"><span># --show-progress：cmd 中可以显示 nuitka 的打包过程</span></span>
<span class="line"><span># --windows-disable-console：去掉 CMD 控制窗口</span></span>
<span class="line"><span># --plugin-enable=tk-inker：打包 tkinter 模块的刚需</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1.0 版本的时候，像 numpy、pandas、matplotlib 这样的第三方模块，是以 --plugin-enable=numpy 的形式出现的，现在已经不这么写了，像 PIL 模块，以及 Numpy 模块都已经放在了 anti-bloat 里了，而 anti-bloat 它是默认自动使用的，所以我们可以直接不用写进去。</p><h2 id="pyinstaller-与-nuitka-打包的对比" tabindex="-1"><a class="header-anchor" href="#pyinstaller-与-nuitka-打包的对比"><span>Pyinstaller 与 Nuitka 打包的对比</span></a></h2><p>第一：经过试验呢，Python 的第三方库的多少，对于两者的 的打包大小都是有影响的，所以如果用的 Anaconda 环境的朋友，一定要用 conda 配置新的虚拟环境，以减少第三方库的不必要导入。</p><p>Pyinstaller 原始环境打包后：300 多 MB；虚拟环境打包后：180 多 MB Nuitka 原始环境打包后：800 多 MB；虚拟环境打包后：190MB</p><p>第二：现阶段，两者打包后的结构非常的相似，在默认输出文件夹 dist 里面，像 Pillow、CV2 这种第三方模块，都是使用的 .dll 托管模式。Nuitka 的打包命令十分复杂，而 Pyinstaller 很简单，并且打包速度更快，UPX 压缩在目前版本里，也是自动开启的。所以我个人觉得 Pyinstaller 更好用一些。</p>`,31),t=[l];function p(r,d){return e(),a("div",null,t)}const h=n(s,[["render",p],["__file","02_file_packaging.html.vue"]]),u=JSON.parse('{"path":"/zh/software/desktop_app/02_file_packaging.html","title":"Python文件打包exe方法","lang":"zh-CN","frontmatter":{"title":"Python文件打包exe方法","order":2,"author":"AOSAI","date":"2023-08-30T00:00:00.000Z","category":["软件打包"],"tag":["Python","Pyinstaller","Nuitka","Mingw64"],"sticky":false,"star":false,"footer":"等我攒够六便士，就去寻找月亮","copyright":"AOSAI","description":"为什么要打包 众所周知，Python 文件不能在没有安装 Python 环境的机器上运行，所以需要通过打包这样的方式，让其可以在任何电脑上直接使用。打包方式应该会很多，但我目前查到的，有两种用的较多的打包方式，Nuitka 和 Pyinstaller。 Pyinstaller 打包 打包单个文件 设置虚拟环境 这样打包简单是简单了，但是打包过程极慢，而...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog-pages/zh/software/desktop_app/02_file_packaging.html"}],["meta",{"property":"og:site_name","content":"青裁的博客"}],["meta",{"property":"og:title","content":"Python文件打包exe方法"}],["meta",{"property":"og:description","content":"为什么要打包 众所周知，Python 文件不能在没有安装 Python 环境的机器上运行，所以需要通过打包这样的方式，让其可以在任何电脑上直接使用。打包方式应该会很多，但我目前查到的，有两种用的较多的打包方式，Nuitka 和 Pyinstaller。 Pyinstaller 打包 打包单个文件 设置虚拟环境 这样打包简单是简单了，但是打包过程极慢，而..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-12T15:46:44.000Z"}],["meta",{"property":"article:author","content":"AOSAI"}],["meta",{"property":"article:tag","content":"Python"}],["meta",{"property":"article:tag","content":"Pyinstaller"}],["meta",{"property":"article:tag","content":"Nuitka"}],["meta",{"property":"article:tag","content":"Mingw64"}],["meta",{"property":"article:published_time","content":"2023-08-30T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-12T15:46:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Python文件打包exe方法\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-08-30T00:00:00.000Z\\",\\"dateModified\\":\\"2024-07-12T15:46:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"AOSAI\\"}]}"]]},"headers":[{"level":2,"title":"为什么要打包","slug":"为什么要打包","link":"#为什么要打包","children":[]},{"level":2,"title":"Pyinstaller 打包","slug":"pyinstaller-打包","link":"#pyinstaller-打包","children":[{"level":3,"title":"打包单个文件","slug":"打包单个文件","link":"#打包单个文件","children":[]},{"level":3,"title":"设置虚拟环境","slug":"设置虚拟环境","link":"#设置虚拟环境","children":[]},{"level":3,"title":"打包多个文件","slug":"打包多个文件","link":"#打包多个文件","children":[]}]},{"level":2,"title":"Nuitka 打包指南（windows）","slug":"nuitka-打包指南-windows","link":"#nuitka-打包指南-windows","children":[{"level":3,"title":"安装 C 编译器","slug":"安装-c-编译器","link":"#安装-c-编译器","children":[]},{"level":3,"title":"Nuitka 基本操作","slug":"nuitka-基本操作","link":"#nuitka-基本操作","children":[]}]},{"level":2,"title":"Pyinstaller 与 Nuitka 打包的对比","slug":"pyinstaller-与-nuitka-打包的对比","link":"#pyinstaller-与-nuitka-打包的对比","children":[]}],"git":{"createdTime":1720799204000,"updatedTime":1720799204000,"contributors":[{"name":"AOSAI","email":"1213860588@qq.com","commits":1}]},"readingTime":{"minutes":5.42,"words":1625},"filePathRelative":"zh/software/desktop_app/02_file_packaging.md","localizedDate":"2023年8月30日","excerpt":"<h2>为什么要打包</h2>\\n<p>众所周知，Python 文件不能在没有安装 Python 环境的机器上运行，所以需要通过打包这样的方式，让其可以在任何电脑上直接使用。打包方式应该会很多，但我目前查到的，有两种用的较多的打包方式，Nuitka 和 Pyinstaller。</p>\\n<h2>Pyinstaller 打包</h2>\\n<h3>打包单个文件</h3>\\n<div class=\\"language- line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"\\" data-title=\\"\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span>pip install pyinstaller     # 下载安装命令</span></span>\\n<span class=\\"line\\"><span></span></span>\\n<span class=\\"line\\"><span># 打包命令的常用基础操作</span></span>\\n<span class=\\"line\\"><span>Pyinstaller -F xxx.py   # 打包exe</span></span>\\n<span class=\\"line\\"><span>Pyinstaller -F -w xxx.py    # 不带控制台打包</span></span>\\n<span class=\\"line\\"><span>Pyinstaller -F -w -i xxx.ico xxx.py    # 指定exe图标打包</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{h as comp,u as data};
